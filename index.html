<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weather Overlay - Yarmouth, NS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Segoe UI Emoji", "Noto Color Emoji", Arial, sans-serif;
      overflow: hidden;
      background: black;
    }

    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      border: none;
      pointer-events: none;
    }

    .top-overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: #00BFFF;
      color: white;
      padding: 12px 24px;
      font-weight: bold;
      font-size: 2rem;
      border-radius: 10px;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .datetime {
      font-size: 1.4rem;
      font-weight: normal;
    }

    .ticker-info {
      position: absolute;
      bottom: 48px;
      width: 100%;
      text-align: center;
      font-size: 0.85rem;
      font-weight: bold;
      color: white;
      z-index: 11;
    }

    .ticker {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40px;
      background-color: black;
      font-size: 1.8rem;
      font-weight: 900;
      color: white;
      text-shadow: 1px 1px 2px black;
      overflow: hidden;
      z-index: 10;
    }

    .ticker-content {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: scrollTicker linear infinite;
      animation-duration: 60s;
    }

    @keyframes scrollTicker {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    .highlight {
      background-color: yellow;
      color: red;
      padding: 0 6px;
      border-radius: 4px;
    }

    @keyframes fadein {
      to { opacity: 1; }
    }
  </style>
</head>
<body>

  <iframe class="background"
    src="https://kitchen.screenfeed.com/feed/4n1sf2ms6qe684xkzs75pw1d5v.html"
    allowfullscreen>
  </iframe>

  <div class="top-overlay">
    üìç YARMOUTH, NS
    <span class="datetime" id="datetime"></span>
  </div>

  <div class="ticker-info">
    Above forecast is multi-model. Below in the ticker is sourced from weather.gc.ca
  </div>

  <div class="ticker">
    <div class="ticker-content" id="ticker-text">
      Loading alerts...
    </div>
  </div>

  <script>
    const ecAlertTerms = [
      "Rainfall Warning", "Snowfall Warning", "Wind Warning", "Heat Warning",
      "Extreme Cold Warning", "Freezing Rain Warning", "Fog Advisory", "Blizzard Warning",
      "Winter Storm Warning", "Snow Squall Warning", "Special Weather Statement",
      "Severe Thunderstorm Watch", "Severe Thunderstorm Warning", "Tornado Watch",
      "Tornado Warning", "Hurricane Watch", "Hurricane Warning", "Tropical Storm Watch",
      "Tropical Storm Warning", "Wind Chill Warning", "Flash Freeze Warning",
      "Arctic Outflow Warning", "Storm Surge Warning", "Storm Surge Watch"
    ];

    function updateTime() {
      const now = new Date();
      const options = {
        timeZone: "America/Halifax",
        month: 'long',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      };
      document.getElementById('datetime').textContent =
        new Intl.DateTimeFormat('en-CA', options).format(now);
    }

    function fetchAndDisplayRSS() {
      const script = document.createElement('script');
      const timestamp = new Date().getTime();
      script.src = "https://api.rss2json.com/v1/api.json?rss_url=https://weather.gc.ca/rss/weather/43.836_-66.12_e.xml&t=" + timestamp + "&callback=showRSS";
      document.body.appendChild(script);
    }

    function showRSS(data) {
      const ticker = document.getElementById('ticker-text');
      if (!data || !data.items) {
        ticker.innerHTML = "No alerts available.";
        return;
      }

      const alerts = data.items.map(item => {
        const title = item.title.trim();
        const isExactMatch = ecAlertTerms.some(term =>
          title.toLowerCase().startsWith(term.toLowerCase())
        );
        return isExactMatch
          ? `<span class="highlight">${title}</span>`
          : title;
      });

      ticker.innerHTML = alerts.length > 0
        ? alerts.join(" ‚Ä¢ ")
        : "No current alerts.";

      // Adjust scroll duration based on text length
      const baseLength = ticker.textContent.length;
      const duration = Math.max(30, baseLength / 3);
      ticker.style.animationDuration = `${duration}s`;
    }

    updateTime();
    setInterval(updateTime, 60000);
    fetchAndDisplayRSS();
  </script>
</body>
</html>